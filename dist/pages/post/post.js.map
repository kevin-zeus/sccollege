{"version":3,"file":"pages/post/post.js","sources":["webpack:///./src/pages/post/post.jsx","webpack:///./src/pages/post/post.jsx?627f","webpack:///./src/pages/post/post.scss"],"sourcesContent":["import React, { Component } from 'react';\nimport { View, Text } from '@tarojs/components';\nimport { connect } from 'react-redux';\n\nimport PostCard from '../../components/post-card/post-card';\nimport CommentCard from '../../components/comment-card/comment-card';\nimport CommentReply from '../../components/comment-reply/comment-reply';\nimport MyPage from '../../components/my-page/my-page';\nimport { Post as PostService, Comment as CommentService } from '../../common/api';\n\nimport './post.scss';\n\n\n@connect(({ user }) => ({\n  user\n}))\nclass Post extends Component {\n  state = {\n    post: null,\n    pageState: 0,\n    page: 1,\n    noMore: false,\n    showMoreLoading: false,\n    commentList: [],\n  }\n\n  componentDidMount() {\n    this.init();\n  }\n\n  onShareAppMessage() {\n    const { post: { content, id } } = this.state;\n    return {\n      title: content.slice(0, 20)+'...',\n      path: '/pages/post/post?id='+id\n    }\n  }\n\n  // 初始化\n  async init() {\n    const { id } = this.$router.params;\n    const { page } = this.state;\n    const post = await PostService.getPostDetail(id);\n\n    const { from_uid } = post;\n    const { user: { id: uid } } = this.props;\n\n    let comment_res = null;\n    if (uid == from_uid) { // 如果当前用户是该帖子的用户\n      comment_res = await CommentService.getCommentsByPostWithSecret(id, page);\n    } else {\n      comment_res = await CommentService.getCommentsByPost(id, page);\n    }\n\n    if (comment_res) { // 如果评论列表存在\n      this.setState({\n        commentList: comment_res,\n        page: page + 1\n      });\n    }\n\n\n    if (post) { // 如果帖子获取成功\n      this.setState({\n        pageState: 3,\n        post\n      });\n    } else {\n      this.setState({\n        pageState: 1,\n      });\n    }\n  }\n\n  // 下拉加载\n  onScrollToLower = async () => {\n    const { post:{id}, page, commentList, noMore } = this.state;\n    if (noMore) return;\n    this.setState({\n      showMoreLoading: true,\n    });\n\n    const newList = await CommentService.getCommentsByPost(id, page);\n    if (newList) {\n      this.setState({\n        commentList: commentList.concat(newList),\n        page: page + 1,\n        showMoreLoading: false\n      });\n    } else {\n      this.setState({\n        noMore: true,\n        showMoreLoading: false\n      });\n    }\n  }\n\n\n  render() {\n    const {\n      pageState,\n      showMoreLoading,\n      post,\n      noMore,\n      commentList,\n    } = this.state;\n    return (\n      <View>\n      <MyPage\n        autoHeight\n        state={pageState}\n        enableTips={noMore}\n        showMoreLoading={showMoreLoading}\n        onScrollToLower={this.onScrollToLower}\n      >\n        <PostCard post={post} canUserHome />\n        <View className='comment-wrap'>\n          <Text>评论列表</Text>\n          {/* <View className='option'>\n            <View className='active'>热门</View>\n            <View className='divi'></View>\n            <View>最新</View>\n          </View> */}\n        </View>\n        {\n          commentList.map((comment) => (\n            <CommentCard key={comment.id} comment={comment} showOption canGoComment />\n          ))\n        }\n        {\n          commentList.length === 0 && (\n            <View className='tip'>\n              还没有人评论哦，快来抢沙发吧\n            </View>\n          )\n        }\n        <View className='bottom'></View>\n      </MyPage>\n      {\n        post && (\n          <CommentReply\n            openSecret\n            openImagePicker\n            canShare\n            type='comment'\n            msgCount={post.comment_count}\n            likesCount={post.likes_count}\n            toUser={post.user}\n            parentId={post.id}\n            doLike={this.doLike}\n          />\n        )\n      }\n      </View>\n    )\n  }\n}\n\nexport default Post;\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./post.jsx\"\nvar config = {\"navigationBarTitleText\":\"帖子详情\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/post/post', {}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAHA;AAAA;AACA;AADA;AAAA;;;;;;;;;;;;;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAyDA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAGA;AACA;AADA;AACA;AAJA;AAAA;AACA;AADA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AACA;AACA;AAFA;AAIA;AACA;AApBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AAjDA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAFA;AAMA;AACA;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAGA;AAEA;AACA;AAEA;AACA;AATA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAUA;AAVA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAYA;AACA;AAbA;AAeA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAFA;AADA;AAMA;AACA;AADA;AAGA;AACA;AAjCA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AAmCA;AACA;;;AAuBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAGA;AACA;AACA;AACA;AACA;AALA;AAOA;AAAA;AAAA;AACA;AAAA;AASA;AACA;AAAA;AAAA;AAAA;AAAA;AAlBA;AAuBA;AAAA;AAKA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AAeA;;;;AA3IA;AA8IA;;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}