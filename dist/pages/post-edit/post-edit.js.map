{"version":3,"file":"pages/post-edit/post-edit.js","sources":["webpack:///./src/pages/post-edit/post-edit.jsx","webpack:///./src/components/post-editor/post-editor.jsx","webpack:///./src/components/post-editor/post-editor.scss","webpack:///./src/pages/post-edit/post-edit.jsx?9259","webpack:///./src/pages/post-edit/post-edit.scss"],"sourcesContent":["import React, { Component } from 'react';\nimport { View } from '@tarojs/components';\n\nimport PostEditor from '../../components/post-editor/post-editor';\n\nimport './post-edit.scss';\n\nclass PostEdit extends Component {\n\n  render() {\n    return (\n      <View>\n        <PostEditor submitText='发布' />\n      </View>\n    );\n  }\n}\n\nexport default PostEdit;\n","import React, { Component } from 'react'\nimport Taro from '@tarojs/taro';\nimport { View } from '@tarojs/components';\nimport { AtTextarea, AtFloatLayout, AtButton, AtIcon, AtImagePicker } from 'taro-ui';\n\nimport './post-editor.scss';\n\nimport TopicList from '../../components/topic-list/topic-list';\n\nimport { Post } from '../../common/api';\n\nclass PostEditor extends Component {\n\n  state = {\n    content: '',\n    topicId: 0,\n    topicName: '',\n    images: [],\n    isOpened: false,\n    disabled: true,\n    count: 9,\n    showAddImg: true,\n    loading: false,\n  }\n\n  componentDidMount() {\n\n  }\n\n  init() {\n    const { postId } = this.props;\n    if (postId) { // 去获取帖子详情\n\n    }\n  }\n\n  handleTopicClick = () => {\n    this.setState({\n      isOpened: true,\n    });\n  }\n\n  handleTextChange = (e) => {\n    const { topicId } = this.state;\n    const content = e.target.value;\n    let disabled = true;\n    if (topicId !== 0 && content.trim() !== '') {\n      disabled = false;\n    }\n    this.setState({\n      content,\n      disabled,\n    });\n  }\n\n  handleImageChange = (files) => {\n    const count = 9 - files.length;\n    let showAddImg = true;\n    if (count === 0) {\n      showAddImg = false;\n    }\n    this.setState({\n      images: files,\n      count,\n      showAddImg,\n    });\n  }\n\n  handleImageClick = (index, file) => {\n    const current = file.url;\n    const { images } = this.state;\n    const urls = images.map((item) => item.url);\n    Taro.previewImage({\n      current,\n      urls\n    });\n  }\n\n  handleClose = () => {\n    this.setState({\n      isOpened: false\n    });\n  }\n\n  onTopicItemClick = (topicId, topicName) => {\n    const { content } = this.state;\n    let disabled = true;\n    if (content.trim() !== '') {\n      disabled = false;\n    }\n    this.setState({\n      topicId,\n      topicName,\n      isOpened: false,\n      disabled,\n    });\n  }\n\n  // 提交\n  submit = async () => {\n    const { images, content, topicId } = this.state;\n    this.setState({\n      disabled: true,\n      loading: true,\n    })\n    // 先上传图片文件\n    let imageList = [];\n    if (images.length !== 0) {\n      const imgs = await Post.uploadImgs(images);\n      imageList = imgs.map((item, index) => ({\n        path: item,\n        index\n      }));\n    }\n    // 在访问后端，发起新建帖子请求\n    const result = await Post.create(topicId, content, imageList);\n    this.setState({\n      disabled: false,\n      loading: false,\n    });\n    if (result) { // 新建成功\n      Taro.navigateBack();\n    }\n\n  }\n\n  render() {\n    const {\n      content,\n      topicId,\n      images,\n      isOpened,\n      disabled,\n      topicName,\n      count,\n      showAddImg,\n      loading,\n    } = this.state;\n    const { submitText } = this.props;\n    return (\n      <View>\n        <View className='form-item list-item' onClick={this.handleTopicClick}>\n          <View className='left'># {topicId === 0 ? '选择话题' : topicName }</View>\n          {\n            topicId === 0 ?\n            <View className='center'>选择合适的话题会有更多的赞哦~</View> : null\n          }\n          <AtIcon size='16' color='#989898' value='chevron-right' />\n        </View>\n        <View className='form-item'>\n          <AtTextarea\n            value={content}\n            onChange={this.handleTextChange}\n            maxLength={200}\n            placeholder='记录真实的校园生活...'\n          />\n        </View>\n        <View className='form-item image-picker'>\n          <AtImagePicker\n            mode='aspectFill'\n            length={3}\n            count={count}\n            files={images}\n            showAddBtn={showAddImg}\n            onChange={this.handleImageChange}\n            onImageClick={this.handleImageClick}\n          />\n        </View>\n        <View className='form-item'>\n          <AtButton onClick={this.submit} disabled={disabled} type='primary' loading={loading}>\n            {submitText}\n          </AtButton>\n        </View>\n        <AtFloatLayout\n          isOpened={isOpened}\n          title='选择一个话题'\n          onClose={this.handleClose}\n        >\n          <TopicList onTopicItemClick={this.onTopicItemClick} />\n        </AtFloatLayout>\n      </View>\n    );\n  }\n}\n\nexport default PostEditor;\n","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./post-edit.jsx\"\nvar config = {\"navigationBarTitleText\":\"发帖子\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/post-edit/post-edit', {}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;AAEA;AACA;AAEA;AAAA;AAGA;;;;AARA;AACA;AAUA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClBA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAsBA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAFA;AACA;AACA;AAGA;AACA;AARA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AASA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AAXA;AAAA;AAAA;AACA;AADA;AAgBA;AACA;AAAA;AACA;AACA;AAFA;AACA;AAGA;AAAA;AACA;AACA;AACA;AAxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AA3EA;;;AAIA;AAAA;AACA;AACA;AAEA;AACA;;;AA4FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AAEA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAEA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAOA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAHA;AAKA;AAAA;AAIA;;;;AA3KA;AACA;AA6KA;;;;;;;;;;;ACzLA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}