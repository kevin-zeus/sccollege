{"version":3,"file":"pages/subPackage/user-edit/user-edit.js","sources":["webpack:///./src/pages/subPackage/user-edit/user-edit.jsx","webpack:///./src/pages/subPackage/user-edit/user-edit.jsx?c808","webpack:///./src/pages/subPackage/user-edit/user-edit.scss"],"sourcesContent":["/* eslint-disable no-shadow */\nimport React, { Component } from 'react'\nimport Taro from '@tarojs/taro';\nimport { connect } from 'react-redux';\nimport { View, Image, Input, Button, PickerView, PickerViewColumn } from '@tarojs/components';\nimport {\n  AtIcon,\n  AtModal,\n  AtModalHeader,\n  AtModalContent,\n  AtModalAction,\n  AtFloatLayout,\n  AtActionSheet,\n  AtActionSheetItem\n} from 'taro-ui';\n\nimport { User, Province } from '../../../common/api';\nimport {\n  changeAvatar,\n  changeNickname,\n  changeLabel,\n  changePathetState,\n  changeBirthday,\n  changeHometown\n} from '../../../actions/user';\n\nimport './user-edit.scss';\n\nconst years = [];\nconst months = [];\nconst days = [];\nfor (let i = 1; i <= 31; i++) {\n  days.push(i);\n}\nfor (let i = 1; i <= 12; i++) {\n  months.push(i);\n}\nfor (let i = 1980; i <= new Date().getFullYear(); i++) {\n  years.push(i);\n}\n\n\n@connect(({ user }) => ({\n  user\n}), (dispatch) => ({\n  dispatch\n}))\nclass UserEdit extends Component {\n\n  state = {\n    pathetEnum: ['保密', '单身', '热恋'],\n    userState: null,\n    showNickNameDialog: false,\n    showLabelDialog: false,\n    showPathetDialog: false,\n    showBirthdayDialog: false,\n    showHometownDialog: false,\n    birthday: [17, 0, 2],\n    years,\n    months,\n    days,\n    hometown: [0, 0],\n    provinces: Province,\n    cities: Province[0]['cities'],\n  }\n\n  componentDidMount() {\n    this.propsMapState();\n  }\n\n  propsMapState() {\n    const { user } = this.props;\n    this.setState({\n      userState: user,\n    });\n  }\n\n  onUpload = async () => {\n    const imgUrl = await User.editAvtater();\n    if (imgUrl) {\n      const { dispatch } = this.props;\n      dispatch(changeAvatar(imgUrl));\n    }\n  }\n\n  updateNickname = async () => {\n    this.hideModal('showNickNameDialog');\n    const { userState: { user_nickname } } = this.state;\n    const result = await User.setUserFiled('user_nickname', user_nickname);\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changeNickname(user_nickname));\n    }\n  }\n\n  updateLabel = async () => {\n    this.hideModal('showLabelDialog');\n    const { label } = this.state.userState;\n    const result = await User.setUserFiled('label', label);\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changeLabel(label));\n    }\n  }\n\n  updateBirthday = async () => {\n    this.hideModal('showBirthdayDialog');\n    const { birthday, years, months, days } = this.state;\n    const year = years[birthday[0]];\n    const month = months[birthday[1]];\n    const day = days[birthday[2]];\n    const time = User.toTimestamp(`${year}-${month}-${day} 0:0:0`);\n    const result = await User.setUserFiled('birthday', time);\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changeBirthday(time));\n    }\n  }\n\n  updateHometown = async () => {\n    this.hideModal('showHometownDialog');\n    const { hometown } = this.state;\n    const value = {};\n    value['province'] = Province[hometown[0]].name;\n    value['city'] = Province[hometown[0]]['cities'][hometown[1]];\n    const result = await User.setUserFiled('hometown', JSON.stringify(value));\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changeHometown(value['province'], value['city']));\n    }\n  }\n\n  handleNicknameInput = (e) => {\n    const nickname = e.detail.value;\n    const { userState } = this.state;\n    this.setState({\n      userState: {\n        ...userState,\n        user_nickname: nickname\n      }\n    });\n  }\n\n  handleLabelInput = (e) => {\n    const label = e.detail.value;\n    const { userState } = this.state;\n    this.setState({\n      userState: {\n        ...userState,\n        label\n      }\n    });\n  }\n\n  handlePathetIndex = async (index) => {\n    this.hideModal('showPathetDialog');\n    const result = await User.setUserFiled('pathet_state', index);\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changePathetState(index));\n    }\n  }\n\n  handleBirthdayChange = (e) => {\n    const birthday = e.detail.value;\n    this.setState({\n      birthday,\n    });\n  }\n\n  handleHometownChange = (e) => {\n    const newHomtown = e.detail.value;\n    const { hometown } = this.state;\n    if (newHomtown[0] !== hometown[0]) { // 省份改变的话\n      this.setState({\n        cities: Province[newHomtown[0]]['cities'],\n        hometown: [newHomtown[0], 0],\n      });\n    } else {\n      this.setState({\n        hometown: newHomtown,\n      });\n    }\n  }\n\n  showModal(type) {\n    const newState = this.state;\n    newState[type] = true;\n    this.setState({\n      ...newState\n    });\n  }\n\n  hideModal(type) {\n    const newState = this.state;\n    newState[type] = false;\n    this.setState({\n      ...newState\n    });\n  }\n\n  goAuth = () => {\n    Taro.navigateTo({\n      url: '/pages/user-school/user-school'\n    });\n  }\n\n  render() {\n    const {\n      userState,\n      showNickNameDialog,\n      showLabelDialog,\n      showPathetDialog,\n      pathetEnum,\n      showBirthdayDialog,\n      birthday,\n      years,\n      months,\n      days,\n      showHometownDialog,\n      hometown,\n      provinces,\n      cities,\n    } = this.state;\n    const {\n      user\n    } = this.props;\n    return (\n      <View className='container'>\n        {/* 修改头像 */}\n        <View class='avtater'>\n          <Image className='image' src={userState.avatar} onClick={this.onUpload} />\n          <View class='btn-edit icon icon-camera-full'></View>\n        </View>\n        {/* 信息 */}\n        <View className='cells'>\n          <View className='cell' onClick={() => this.showModal('showNickNameDialog')}>\n            <View className='left'>昵称</View>\n            <View className='right'>\n              <View>{user.user_nickname}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n          <View className='cell' onClick={() => this.showModal('showLabelDialog')}>\n            <View className='left'>个性签名</View>\n            <View className='right'>\n              <View>{user.label || '一句话介绍自己'}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n          <View className='cell' onClick={() => this.showModal('showPathetDialog')}>\n            <View className='left'>感情状况</View>\n            <View className='right'>\n              <View>{pathetEnum[user.pathet_state] || '未知'}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n          <View className='cell' onClick={() => this.showModal('showBirthdayDialog')}>\n            <View className='left'>生日</View>\n            <View className='right'>\n              <View>{ user.birthday ? User.timeToBirthday(user.birthday) : '未设置'}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n          <View className='cell' onClick={() => this.showModal('showHometownDialog')}>\n            <View className='left'>故乡</View>\n            <View className='right'>\n              <View>{user.province} {user.city}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n        </View>\n        <View className='cells'>\n          <View className='cell'>\n            <View className='left'>就读学校</View>\n            <View className='right'>\n              <View>{user.school || '未设置'}</View>\n            </View>\n          </View>\n          <View className='cell'>\n            <View className='left'>学历</View>\n            <View className='right'>\n              <View>{['未知','专科','本科','硕士', '博士'][user.degree] || '未设置'}</View>\n            </View>\n          </View>\n          <View className='cell'>\n            <View className='left'>入学年份</View>\n            <View className='right'>\n              <View>{user.school_year || '未设置'}</View>\n            </View>\n          </View>\n          {\n            userState.is_auth !== 2 ? (\n              <View className='cell btn-cell' onClick={this.goAuth}>\n                <View className='icon icon-auth-1'></View>\n                <View>去学生认证</View>\n              </View>\n            ) : null\n          }\n        </View>\n\n        <AtModal\n          isOpened={showNickNameDialog}\n          onClose={() => this.hideModal('showNickNameDialog')}\n        >\n          <AtModalHeader>修改昵称</AtModalHeader>\n          <AtModalContent>\n            <Input onInput={this.handleNicknameInput} value={userState.user_nickname} focus={showNickNameDialog} className='nick-input input-bg' />\n          </AtModalContent>\n          <AtModalAction>\n            <Button onClick={() => this.hideModal('showNickNameDialog')}>取消</Button>\n            <Button onClick={this.updateNickname}>确定</Button>\n          </AtModalAction>\n        </AtModal>\n        <AtModal\n          isOpened={showLabelDialog}\n          onClose={() => this.hideModal('showLabelDialog')}\n        >\n          <AtModalHeader>修改个性签名</AtModalHeader>\n          <AtModalContent>\n            <Input\n              onInput={this.handleLabelInput}\n              value={userState.label}\n              focus={showLabelDialog}\n              className='nick-input input-bg'\n            />\n          </AtModalContent>\n          <AtModalAction>\n            <Button onClick={() => this.hideModal('showLabelDialog')}>取消</Button>\n            <Button onClick={this.updateLabel}>确定</Button>\n          </AtModalAction>\n        </AtModal>\n        {/* 感情状况 */}\n        <AtActionSheet\n          isOpened={showPathetDialog}\n          cancelText='取消'\n          onCancel={() => this.hideModal('showPathetDialog')}\n          onClose={() => this.hideModal('showPathetDialog')}\n        >\n          {\n            pathetEnum.map((item, index) => (\n              <AtActionSheetItem key={`pathet_${index}`} onClick={() => this.handlePathetIndex(index)}>\n              {item}\n              </AtActionSheetItem>\n            ))\n          }\n        </AtActionSheet>\n        {/* 生日 */}\n        <AtFloatLayout\n          isOpened={showBirthdayDialog}\n          onClose={() => this.hideModal('showBirthdayDialog')}\n        >\n          <View className='picker-title' style={{ height: '50px', width: '100%'}}>\n            <View className='btn' onClick={() => this.hideModal('showBirthdayDialog')}>取消</View>\n            <View>选择生日</View>\n            <View className='btn confirm' onClick={this.updateBirthday}>确认</View>\n          </View>\n          <PickerView\n            value={birthday}\n            onChange={this.handleBirthdayChange}\n            indicator-style='height: 50px;'\n            style='height: 150px;'\n          >\n            <PickerViewColumn>\n              {\n                years.map((item, index) => (\n                  <View key={`year_${index}`} className='picker-col'>{item}年</View>\n                ))\n              }\n            </PickerViewColumn>\n            <PickerViewColumn>\n              {\n                months.map((item, index) => (\n                  <View key={`month_${index}`} className='picker-col'>{item}月</View>\n                ))\n              }\n            </PickerViewColumn>\n            <PickerViewColumn>\n              {\n                days.map((item, index) => (\n                  <View key={`day_${index}`} className='picker-col'>{item}日</View>\n                ))\n              }\n            </PickerViewColumn>\n          </PickerView>\n        </AtFloatLayout>\n        {/* 故乡 */}\n        <AtFloatLayout\n          isOpened={showHometownDialog}\n          onClose={() => this.hideModal('showHometownDialog')}\n        >\n          <View className='picker-title' style={{ height: '50px', width: '100%'}}>\n            <View className='btn' onClick={() => this.hideModal('showHometownDialog')}>取消</View>\n            <View>选择故乡</View>\n            <View className='btn confirm' onClick={this.updateHometown}>确认</View>\n          </View>\n          <PickerView\n            value={hometown}\n            onChange={this.handleHometownChange}\n            indicator-style='height: 50px;'\n            style='height: 150px;'\n          >\n            <PickerViewColumn>\n              {\n                provinces.map((item, index) => (\n                  <View key={`province_${index}`} className='picker-col'>{item.name}</View>\n                ))\n              }\n            </PickerViewColumn>\n            <PickerViewColumn>\n              {\n                cities.map((item, index) => (\n                  <View key={`city_${index}`} className='picker-col'>{item}</View>\n                ))\n              }\n            </PickerViewColumn>\n          </PickerView>\n        </AtFloatLayout>\n      </View>\n    );\n  }\n}\n\nexport default UserEdit;\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./user-edit.jsx\"\nvar config = {\"navigationBarTitleText\":\"编辑个人资料\",\"navigationBarBackgroundColor\":\"#f8f8f8\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/subPackage/user-edit/user-edit', {}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAWA;AACA;AASA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAOA;AALA;AAAA;AACA;AADA;AAAA;AAEA;AACA;AADA;AAFA;;;;;;;;;;;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AACA;AA2BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAFA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAFA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAUA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AACA;AACA;AANA;AAAA;AACA;AADA;AAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AAZA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAcA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAAA;AACA;AADA;AAMA;AACA;AAAA;AACA;AACA;AACA;AACA;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAaA;AACA;AADA;AACA;AAEA;AACA;AAEA;AAFA;AADA;;;AAQA;AACA;AADA;AACA;AAEA;AACA;AAEA;AAFA;AADA;;;;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AASA;AACA;AACA;AAAA;AACA;AADA;;;AAKA;AACA;AADA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAFA;AADA;AAMA;AACA;AADA;AAGA;;;AAmBA;AACA;AACA;AADA;;;;;;;;AAxIA;AACA;AACA;;;AAEA;AAAA;AAEA;AACA;AADA;AAGA;;;AA8GA;AACA;AACA;AACA;AAGA;;;AAEA;AACA;AACA;AACA;AAGA;;;AAQA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAIA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAIA;AAAA;AACA;AAAA;AACA;AAAA;AAIA;AAAA;AACA;AAAA;AACA;AAAA;AAMA;AAAA;AAAA;AACA;AAAA;AAQA;AACA;AAAA;AAAA;AAFA;AAMA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AAIA;AACA;AAAA;AAAA;AAFA;AAOA;AACA;AACA;AACA;AAJA;AAQA;AAAA;AAAA;AAAA;AACA;AAAA;AAKA;AACA;AACA;AAAA;AAHA;AAIA;AAAA;AAAA;AAJA;AAOA;AACA;AAAA;AAAA;AAAA;AAAA;AAjHA;AAyHA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAJA;AAQA;AACA;AAAA;AAAA;AATA;AAeA;AACA;AAAA;AAAA;AAhBA;AAsBA;AACA;AAAA;AAAA;AAxJA;AAgKA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAJA;AAQA;AACA;AAAA;AAAA;AATA;AAeA;AACA;AAAA;AAAA;AAzLA;AAiMA;;;;AArXA;AAwXA;;;;;;;;;;;;;ACvaA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}