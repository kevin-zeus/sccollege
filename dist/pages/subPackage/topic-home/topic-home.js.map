{"version":3,"file":"pages/subPackage/topic-home/topic-home.js","sources":["webpack:///./src/pages/subPackage/topic-home/topic-home.jsx","webpack:///./src/pages/subPackage/topic-home/topic-home.jsx?a5f0","webpack:///./src/pages/subPackage/topic-home/topic-home.scss"],"sourcesContent":["import React, { Component } from 'react';\nimport Taro from '@tarojs/taro';\nimport { View } from '@tarojs/components';\nimport { AtAvatar, AtButton } from 'taro-ui';\n\nimport MyPage from '../../../components/my-page/my-page';\nimport PostCard from '../../../components/post-card/post-card';\n\nimport { Topic, Post, Follow } from '../../../common/api';\n\nimport './topic-home.scss';\n\nexport default class TopicHome extends Component {\n\n  state = {\n    topic: null,\n    pageState: 0,\n    postList: [],\n    page: 1,\n    noMore: false,\n    showMoreLoading: false,\n    isFollow: false,\n    follow_count: 0,\n  }\n\n  componentDidMount() {\n    this.init();\n  }\n\n  onShareAppMessage() {\n    const { topic: { title, id } } = this.state;\n    return {\n      title: '# '+title,\n      path: '/pages/subPackage/topic-home/topic-home?id='+id\n    }\n  }\n\n  async init() {\n    const { id } = this.$router.params;\n    const { page } = this.state;\n    const topic = await Topic.getTopic(id);\n    if (topic) {\n      this.setState({\n        topic,\n        follow_count: topic.follow_count\n      });\n      Taro.setNavigationBarTitle({\n        title: topic.title\n      });\n    }\n\n    const isFollow = Follow.isFollowTopic(id);\n    this.setState({\n      isFollow,\n    });\n    console.log(isFollow);\n\n    const postList = await Post.getPostsWithTopic(id, page);\n    if (postList) {\n      this.setState({\n        postList,\n        page: page + 1,\n        pageState: 3,\n      });\n    } else {\n      this.setState({\n        pageState: 1,\n      });\n    }\n  }\n\n  onScrollToLower = async () => {\n    console.log('到底了');\n    const { topic: {id}, page, postList, noMore } = this.state;\n    if (noMore) return;\n    this.setState({\n      showMoreLoading: true,\n    });\n\n    const newPostList = await Post.getPostsWithTopic(id, page);\n    if (newPostList) {\n      this.setState({\n        postList: postList.concat(newPostList),\n        page: page + 1,\n        showMoreLoading: false\n      });\n    } else {\n      this.setState({\n        noMore: true,\n        showMoreLoading: false\n      });\n    }\n  }\n\n  followClick = async () => {\n    const { isFollow, topic: {id}, follow_count } = this.state;\n    let res = false, followCount = follow_count;\n    if (isFollow) {\n      res = await Follow.cancelFollowTopic(id);\n      followCount--;\n    } else {\n      res = await Follow.followTopic(id);\n      followCount++;\n    }\n    if (res) {\n      this.setState({\n        isFollow: !isFollow,\n        follow_count: followCount,\n      });\n    }\n  }\n\n  render() {\n    const {\n      pageState, showMoreLoading, topic, postList, noMore, isFollow, follow_count\n    } = this.state;\n    return (\n      <MyPage\n        autoHeight\n        state={pageState}\n        enableTips={noMore}\n        showMoreLoading={showMoreLoading}\n        onScrollToLower={this.onScrollToLower}\n      >\n        {\n          topic && (\n            <View className='topic-box'>\n              <View className='mask' style={{\n                backgroundImage: `url('${topic.icon_path}')`,\n                backgroundSize: 'cover',\n                backgroundRepeat: 'none',\n                backgroundPosition: 'center center'\n              }}\n              ></View>\n              <View className='topic'>\n                <AtAvatar image={topic.icon_path} />\n                <View className='title'>{topic.title}</View>\n                <View className='des'>{topic.des}</View>\n                <View className='follow'>{follow_count} 个{topic.follow_name}</View>\n                <AtButton\n                  size='small'\n                  circle\n                  type={isFollow ? 'secondary' : 'primary'}\n                  onClick={this.followClick}\n                >{isFollow ? '已关注' : '关注'}</AtButton>\n              </View>\n            </View>\n          )\n        }\n        {\n          postList.map(post => (\n            <PostCard\n              key={post.id}\n              post={post}\n              canUserHome\n              showOption\n              canGoPost\n            />\n          ))\n        }\n      </MyPage>\n    )\n  }\n}\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./topic-home.jsx\"\nvar config = {\"navigationBarTitleText\":\"话题详情\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/subPackage/topic-home/topic-home', {}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AAwDA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAIA;AACA;AADA;AACA;AALA;AAAA;AACA;AADA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AACA;AACA;AAFA;AAIA;AACA;AArBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAuBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAIA;AACA;AALA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAOA;AACA;AACA;AATA;AAUA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAhBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AArEA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAFA;AAIA;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AADA;AAGA;AAlBA;AAAA;AACA;AADA;AAoBA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AACA;AADA;AAGA;AACA;AAhCA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;AA2EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAEA;AACA;AACA;AACA;AACA;AALA;AASA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AAOA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAWA;AAEA;AACA;AACA;AACA;AACA;AALA;AAnCA;AA8CA;;;;AAtJA;AACA;;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}