{"version":3,"file":"pages/subPackage/comment/comment.js","sources":["webpack:///./src/pages/subPackage/comment/comment.jsx","webpack:///./src/components/reply-card/reply-card.jsx","webpack:///./src/components/reply-card/reply-card.scss","webpack:///./src/pages/subPackage/comment/comment.jsx?8737","webpack:///./src/pages/subPackage/comment/comment.scss"],"sourcesContent":["import React, { Component } from 'react';\nimport { View } from '@tarojs/components';\n\nimport MyPage from '../../../components/my-page/my-page';\nimport CommentCard from '../../../components/comment-card/comment-card';\nimport CommentReply from '../../../components/comment-reply/comment-reply';\nimport ReplyCard from '../../../components/reply-card/reply-card';\n\nimport {\n  Comment as CommentService,\n  Reply as ReplyService,\n  Reply\n} from '../../../common/api';\n\nimport './comment.scss';\n\nexport default class Comment extends Component {\n\n  state = {\n    comment: null,\n    pageState: 0,\n    replyList: [],\n    page: 1,\n    noMore: false,\n    showMoreLoading: false,\n    toUser: null,\n  }\n\n  componentDidMount() {\n    this.init();\n  }\n\n  async init() {\n    const { id } = this.$router.params;\n    const { page } = this.state;\n    const comment = await CommentService.getCommentDetail(id);\n\n    const reply_res = await ReplyService.getReplysByComment(id, page);\n    if (reply_res) { // 如果回复列表存在\n      this.setState({\n        replyList: reply_res,\n        page: page + 1\n      });\n    }\n\n    if (comment) { // 如果评论获取成功\n      this.setState({\n        pageState: 3,\n        comment,\n        toUser: comment.user\n      });\n    } else {\n      this.setState({\n        pageState: 1,\n      });\n    }\n  }\n\n  // 上拉加载\n  onScrollToLower = async () => {\n    const { id } = this.$router.params;\n    const { page, replyList, noMore } = this.state;\n    if (noMore) return;\n    this.setState({\n      showMoreLoading: true,\n    });\n\n    const newList = await Reply.getReplysByComment(id, page);\n    if (newList) {\n      this.setState({\n        replyList: replyList.concat(newList),\n        page: page + 1,\n        showMoreLoading: false\n      });\n    } else {\n      this.setState({\n        noMore: true,\n        showMoreLoading: false\n      });\n    }\n  }\n\n  replyClick(reply) {\n    console.log(reply);\n    const { user } = reply;\n    this.setState({\n      toUser: user,\n    });\n  }\n\n  render() {\n    const {\n      comment, pageState, noMore, showMoreLoading, toUser, replyList\n    } = this.state;\n    return (\n      <View>\n        <MyPage\n          autoHeight\n          state={pageState}\n          enableTips={noMore}\n          showMoreLoading={showMoreLoading}\n          onScrollToLower={this.onScrollToLower}\n        >\n          {\n            comment && (\n              <CommentCard\n                comment={comment}\n              />\n            )\n          }\n          <View className='tip'>回复列表</View>\n          {\n            replyList.map(reply => (\n              <ReplyCard key={reply.id} reply={reply} onContentClick={() => this.replyClick(reply)} commentUserId={comment.user.id} />\n            ))\n          }\n        </MyPage>\n        {\n          comment && (\n            <CommentReply\n              type='reply'\n              msgCount={comment.reply_count}\n              likesCount={comment.likes_count}\n              toUser={toUser}\n              parentId={comment.id}\n              doLike={this.doLike}\n            />\n          )\n        }\n      </View>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport { View, Text } from '@tarojs/components';\nimport { AtAvatar } from 'taro-ui';\n\nimport { Like } from '../../common/api';\n\nimport './reply-card.scss';\n\nexport default class ReplyCard extends Component {\n\n  state = {\n    reply_data: null,\n    likes_count: 0,\n    isLike: false,\n  }\n\n  componentDidMount() {\n    this.init();\n  }\n\n  async init() {\n    const { reply } = this.props;\n    const isLike = Like.isLike('reply', reply.id) || false;\n    this.setState({\n      reply_data: reply,\n      likes_count: reply.likes_count,\n      isLike,\n    })\n  }\n\n  handleClick = () => {\n    const { onContentClick } = this.props;\n    if (typeof onContentClick === 'function') {\n      onContentClick();\n    }\n  }\n\n  doLike = async () => {\n    const { reply_data, likes_count } = this.state;\n    const res = Like.doLike('reply', reply_data.id);\n    if (res) {\n      this.setState({\n        isLike: true,\n        likes_count: likes_count + 1\n      });\n    }\n  }\n\n  render() {\n    const { reply_data, likes_count, isLike } = this.state;\n    const { commentUserId } = this.props;\n    return (\n      <View>\n        {\n          reply_data && (\n            <View className='card'>\n              <AtAvatar image={reply_data.user.avatar} size='small' circle />\n              <View className='right'>\n                <View className='header'>\n                  <View>\n                    <View className='nickname'>{reply_data.user.user_nickname}</View>\n                    <View className='school'>{reply_data.user.school || '某高校'}</View>\n                  </View>\n                  {/* <View className='jubao'>举报</View> */}\n                </View>\n                <View className='center' onClick={this.handleClick}>\n                  {\n                    reply_data.user.id != commentUserId ? (\n                      <Text className='aite'>@{reply_data.user.user_nickname}</Text>\n                    ) : null\n                  }\n                  <Text className='content'>{reply_data.content}</Text>\n                </View>\n                <View className='footer'>\n                  <View className='date'>{reply_data.create_at}</View>\n                  <View\n                    className={[\n                      'icon',\n                      isLike ? 'icon-zan-full' : 'icon-zan-line'\n                    ]}\n                    onClick={this.doLike}\n                  >{likes_count}</View>\n                </View>\n              </View>\n            </View>\n          )\n        }\n      </View>\n    )\n  }\n}\n","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./comment.jsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/subPackage/comment/comment', {}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAMA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AACA;AAwCA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAIA;AACA;AADA;AACA;AALA;AAAA;AACA;AADA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AACA;AACA;AAFA;AAIA;AACA;AArBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AA/BA;AACA;AACA;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AACA;AADA;AAKA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AACA;AADA;AAGA;AACA;AAxBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AA0BA;AACA;;;AAuBA;AACA;AADA;AAGA;AACA;AADA;AAGA;;;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAGA;AACA;AACA;AACA;AACA;AALA;AAUA;AADA;AAKA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAlBA;AAyBA;AACA;AACA;AACA;AACA;AACA;AANA;AAYA;;;;AAnHA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjBA;AACA;AACA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AAHA;AACA;AAmBA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAtBA;AACA;AACA;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;AA2BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAIA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAIA;AAAA;AAAA;AAGA;AAAA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AAEA;AAIA;AALA;AAcA;;;;AAjFA;AACA;;;;;;;;;;;;ACTA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}