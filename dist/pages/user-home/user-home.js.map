{"version":3,"file":"pages/user-home/user-home.js","sources":["webpack:///./src/pages/user-home/user-home.jsx","webpack:///./src/pages/user-home/user-home.jsx?f156","webpack:///./src/pages/user-home/user-home.scss"],"sourcesContent":["import React, { Component } from 'react';\nimport Taro from '@tarojs/taro';\nimport { View, Text } from '@tarojs/components';\nimport { AtAvatar, AtButton } from 'taro-ui';\nimport './user-home.scss';\n\nimport MyPage from '../../components/my-page/my-page';\nimport PostCard from '../../components/post-card/post-card';\n\nimport { User, Post, Follow } from '../../common/api';\n\nclass UserHome extends Component {\n  state = {\n    user: null,\n    postList: [],\n    page: 1,\n    noMore: false,\n\n    pageState: 0,\n    showMoreLoading: false,\n\n    isFollow: false,\n    fans_count: 0,\n\n  }\n\n  componentDidMount() {\n    this.init();\n  }\n\n  onShareAppMessage() {\n    const { user: { user_nickname, id } } = this.state;\n    return {\n      title: `【${user_nickname}】的个人主页`,\n      path: '/pages/user-home/user-home?id='+id\n    }\n  }\n\n  init = async () => {\n    this.setState({\n      pageState: 0,\n    });\n    const { id } = this.$router.params;\n    const user = await User.getInfo(id);\n    const postList = await Post.getWithUID(id);\n    const isFollow = await Follow.isFollowUser(id);\n    let pageState = 1;\n    if (user && postList) {\n      pageState = 3;\n      Taro.setNavigationBarTitle({\n        title: user.user_nickname\n      });\n    }\n    this.setState({\n      user,\n      fans_count: user.fans_count,\n      postList,\n      pageState,\n      isFollow,\n      page: this.state.page + 1,\n    });\n  }\n\n  // 加载更多\n  onScrollToLower = async () => {\n    console.log('加载更多');\n    const { user: {id}, page, postList, noMore } = this.state;\n    if (noMore) return;\n    this.setState({\n      showMoreLoading: true,\n    });\n\n    const newPostList = await Post.getWithUID(id, page);\n    if (newPostList) {\n      this.setState({\n        postList: postList.concat(newPostList),\n        page: page + 1,\n        showMoreLoading: false\n      });\n    } else {\n      this.setState({\n        noMore: true,\n        showMoreLoading: false\n      });\n    }\n  }\n\n  onRef = (page) => {\n    this.mypage = page;\n  }\n\n  goFans = () => {\n\n  }\n\n  goFollows = () => {\n\n  }\n\n  goTopics = () => {\n\n  }\n\n  followClick = async () => {\n    const { isFollow, user: {id}, fans_count } = this.state;\n    let res = false, followCount = fans_count;\n    if (isFollow) {\n      res = await Follow.cancelFollowUser(id);\n      followCount--;\n    } else {\n      res = await Follow.followUser(id);\n      followCount++;\n    }\n    if (res) {\n      this.setState({\n        isFollow: !isFollow,\n        fans_count: followCount,\n      });\n    }\n  }\n\n  render() {\n    const {\n      pageState,\n      showMoreLoading,\n      user,\n      postList,\n      fans_count,\n      isFollow,\n    } = this.state;\n    return (\n      <View className='container'>\n        <MyPage\n          autoHeight\n          state={pageState}\n          enableTips={false}\n          showMoreLoading={showMoreLoading}\n          onScrollToLower={this.onScrollToLower}\n          onRetry={this.init}\n          onRef={this.onRef}\n        >\n          {/* 用户头像 */}\n          {\n            user && (\n              <View\n                className='user-box'\n              >\n                <View className='mask' style={{\n                  backgroundImage: `url('${user.avatar}')`,\n                  backgroundSize: 'cover',\n                  backgroundRepeat: 'none',\n                  backgroundPosition: 'center center'\n                }}\n                ></View>\n                <View className='top'>\n                  <AtAvatar className='shadow' image={user.avatar} circle size='large' />\n                  <AtButton\n                    size='small'\n                    circle\n                    type={isFollow ? 'secondary' : 'primary'}\n                    onClick={this.followClick}\n                  >{isFollow ? '已关注' : '关注'}</AtButton>\n                </View>\n                <View className='center'>\n                  <View className='nickname'>{user.user_nickname}</View>\n                  <View className='school'>{user.school || '某高校'}</View>\n                </View>\n                <View className='bottom'>\n                  <View className='tip' onClick={this.goFans}>\n                    {fans_count}<Text className='txt'>粉丝</Text>\n                  </View>\n                  <View className='tip' onClick={this.goFollows}>\n                    {user.follow_count}<Text className='txt'>关注</Text>\n                  </View>\n                  <View className='tip' onClick={this.goTopics}>\n                    {user.topic_count}<Text className='txt'>话题</Text>\n                  </View>\n                </View>\n              </View>\n            )\n          }\n          {\n            postList.map((item) => (\n              <PostCard key={item.id} post={item} canUserHome={false} showOption canGoPost />\n            ))\n          }\n        </MyPage>\n      </View>\n    );\n  }\n}\n\nexport default UserHome;\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./user-home.jsx\"\nvar config = {\"navigationBarTitleText\":\"用户主页\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/user-home/user-home', {}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAVA;AACA;AAyBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AACA;AAEA;AAJA;AAAA;AACA;AADA;AAKA;AALA;AAAA;AACA;AADA;AAMA;AANA;AAAA;AACA;AADA;AAOA;AACA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AACA;AAhBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AA0BA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAIA;AACA;AADA;AACA;AALA;AAAA;AACA;AADA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AADA;AAOA;AACA;AACA;AAFA;AAIA;AACA;AArBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAuBA;AACA;;;AAGA;AACA;AAGA;AACA;AAGA;AACA;AAGA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAIA;AACA;AALA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAOA;AACA;AACA;AATA;AAUA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAhBA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AA7EA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAFA;AAIA;;;AAqFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAaA;AADA;AAGA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AAOA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAOA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAOA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AArDA;AA2DA;;;;AAlLA;AACA;AAoLA;;;;;;;;;;;;;AChMA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}