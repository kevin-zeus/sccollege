{"version":3,"file":"pages/user-school/user-school.js","sources":["webpack:///./src/pages/user-school/user-school.jsx","webpack:///./src/pages/user-school/user-school.jsx?6b45","webpack:///./src/pages/user-school/user-school.scss"],"sourcesContent":["/* eslint-disable no-shadow */\nimport React, { Component } from 'react';\nimport Taro from '@tarojs/taro';\nimport {\n  View, PickerView, PickerViewColumn\n} from '@tarojs/components';\nimport { connect } from 'react-redux';\n\nimport { AtIcon, AtFloatLayout } from 'taro-ui';\n\nimport './user-school.scss';\n\nimport Footer from '../../components/guide-footer/guide-footer';\nimport { User } from '../../common/api';\nimport {\n  changeDegree,\n  changeSchool,\n  changeSchoolYear\n} from '../../actions/user';\n\nconst years = [];\nconst currentYear = +new Date().getFullYear();\nfor (let i = currentYear - 8; i <= currentYear; i++) {\n  years.push(i);\n}\n\n@connect(({ user }) => ({\n  user\n}), (dispatch) => ({\n  dispatch,\n}))\nclass UserSchool extends Component {\n\n  state = {\n    showDegreeDialog: false,\n    showSchoolDialog: false,\n    showYearDialog: false,\n    degrees: ['未设置', '专科', '本科', '硕士', '博士'],\n    selectedDegree: [2],\n    schools: [],\n    selectedSchool: [0],\n    years,\n    selectedYear: [3],\n  }\n\n  componentDidMount() {\n    this.init();\n  }\n\n  async init() {\n    const schools = await User.getSichuanUniversity();\n    this.setState({\n      schools,\n    })\n  }\n\n  handleSchool = (e) => {\n    const { value } = e.detail;\n    this.setState({\n      selectedSchool: value,\n    })\n  }\n\n  handleDegree = (e) => {\n    const { value } = e.detail;\n    this.setState({\n      selectedDegree: value,\n    })\n  }\n\n  handleYear = (e) => {\n    const { value } = e.detail;\n    this.setState({\n      selectedYear: value,\n    })\n  }\n\n  updateDegree = async () => {\n    const { selectedDegree } = this.state;\n    if (selectedDegree[0] === 0) {\n      Taro.showToast({\n        icon: 'none',\n        title: '学历不能选择未设置选项'\n      });\n      return;\n    }\n    this.hideModal('showDegreeDialog');\n    const result = await User.setUserFiled('degree', selectedDegree[0]);\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changeDegree(selectedDegree[0]));\n    }\n  }\n\n  updateSchool = async () => {\n    const { selectedSchool, schools } = this.state;\n    const schoolName = schools[selectedSchool[0]];\n    this.hideModal('showSchoolDialog');\n    const result = await User.setUserFiled('school', schoolName);\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changeSchool(schoolName));\n    }\n  }\n\n  updateYear = async () => {\n    const { selectedYear, years } = this.state;\n    const year = years[selectedYear[0]];\n    this.hideModal('showYearDialog');\n    const result = await User.setUserFiled('school_year', year);\n    if (result) {\n      const { dispatch } = this.props;\n      dispatch(changeSchoolYear(year));\n    }\n  }\n\n  showModal(type) {\n    const newState = this.state;\n    newState[type] = true;\n    this.setState({\n      ...newState\n    });\n  }\n\n  hideModal(type) {\n    const newState = this.state;\n    newState[type] = false;\n    this.setState({\n      ...newState\n    });\n  }\n\n  goVerify = () => {\n    const { user } = this.props;\n    if (!user.school || !user.degree || !user.school_year ) {\n      User.showToast('请先补全学校信息');\n      return;\n    }\n    Taro.navigateTo({\n      url: '/pages/user-verify/user-verify'\n    })\n  }\n\n  render() {\n    const {\n      degrees,\n      selectedDegree,\n      showDegreeDialog,\n      showSchoolDialog,\n      schools,\n      selectedSchool,\n      showYearDialog,\n      years,\n      selectedYear,\n    } = this.state;\n    const {\n      user\n    } = this.props;\n    return (\n      <View>\n        <View className='cells'>\n          <View className='cell' onClick={() => this.showModal('showSchoolDialog')}>\n            <View className='left'>就读学校</View>\n            <View className='right'>\n              <View>{user.school || '未设置'}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n          <View className='cell' onClick={() => this.showModal('showDegreeDialog')}>\n            <View className='left'>学历</View>\n            <View className='right'>\n              <View>{degrees[user.degree] || '未设置'}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n          <View className='cell' onClick={() => this.showModal('showYearDialog')}>\n            <View className='left'>入学年份</View>\n            <View className='right'>\n              <View>{user.school_year || '未设置'}</View>\n              <AtIcon value='chevron-right' size='14' />\n            </View>\n          </View>\n        </View>\n        <Footer\n          btntext='下一步'\n          des='点击下一步，进行学生认证'\n          onBtnTap={this.goVerify}\n        />\n\n        {/* 选择学校 */}\n        <AtFloatLayout\n          isOpened={showSchoolDialog}\n          onClose={() => this.hideModal('showSchoolDialog')}\n        >\n          <View className='picker-title' style={{ height: '50px', width: '100%'}}>\n            <View className='btn' onClick={() => this.hideModal('showSchoolDialog')}>取消</View>\n            <View>选择学校</View>\n            <View className='btn confirm' onClick={this.updateSchool}>确认</View>\n          </View>\n          <PickerView\n            value={selectedSchool}\n            onChange={this.handleSchool}\n            indicator-style='height: 50px;'\n            style='height: 200px;'\n          >\n            <PickerViewColumn>\n              {\n                schools.map((item, index) => (\n                  <View key={`school_${index}`} className='picker-col'>{item}</View>\n                ))\n              }\n            </PickerViewColumn>\n          </PickerView>\n        </AtFloatLayout>\n        {/* 选择学历 */}\n        <AtFloatLayout\n          isOpened={showDegreeDialog}\n          onClose={() => this.hideModal('showDegreeDialog')}\n        >\n          <View className='picker-title' style={{ height: '50px', width: '100%'}}>\n            <View className='btn' onClick={() => this.hideModal('showDegreeDialog')}>取消</View>\n            <View>选择学历</View>\n            <View className='btn confirm' onClick={this.updateDegree}>确认</View>\n          </View>\n          <PickerView\n            value={selectedDegree}\n            onChange={this.handleDegree}\n            indicator-style='height: 50px;'\n            style='height: 200px;'\n          >\n            <PickerViewColumn>\n              {\n                degrees.map((item, index) => (\n                  <View key={`school_${index}`} className='picker-col'>{item}</View>\n                ))\n              }\n            </PickerViewColumn>\n          </PickerView>\n        </AtFloatLayout>\n        {/* 选择入学年份 */}\n        <AtFloatLayout\n          isOpened={showYearDialog}\n          onClose={() => this.hideModal('showYearDialog')}\n        >\n          <View className='picker-title' style={{ height: '50px', width: '100%'}}>\n            <View className='btn' onClick={() => this.hideModal('showYearDialog')}>取消</View>\n            <View>选择入学年份</View>\n            <View className='btn confirm' onClick={this.updateYear}>确认</View>\n          </View>\n          <PickerView\n            value={selectedYear}\n            onChange={this.handleYear}\n            indicator-style='height: 50px;'\n            style='height: 200px;'\n          >\n            <PickerViewColumn>\n              {\n                years.map((item, index) => (\n                  <View key={`school_${index}`} className='picker-col'>{item}</View>\n                ))\n              }\n            </PickerViewColumn>\n          </PickerView>\n        </AtFloatLayout>\n      </View>\n    );\n  }\n}\n\nexport default UserSchool;\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/@tarojs/mini-runner/node_modules/babel-loader/lib/index.js!./user-school.jsx\"\nvar config = {\"navigationBarTitleText\":\"编辑学校信息\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/user-school/user-school', {}, config || {}))\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AADA;AACA;AACA;AAGA;AAEA;AAEA;AAEA;AACA;AACA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AAMA;AALA;AAAA;AACA;AADA;AAAA;AAEA;AACA;AADA;AAFA;;;;;;;;;;;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAsBA;AAAA;AACA;AACA;AACA;AADA;;;AAKA;AAAA;AACA;AACA;AACA;AADA;;;AAKA;AAAA;AACA;AACA;AACA;AADA;;;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAFA;AAHA;AACA;AADA;AASA;AACA;AAVA;AAAA;AACA;AADA;AAUA;AACA;AAAA;AACA;AACA;AACA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAiBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AAJA;AAAA;AACA;AADA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAWA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AAJA;AAAA;AACA;AADA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AA2BA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;;;;;;;;AA7FA;AACA;AACA;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AACA;AADA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;AAmEA;AACA;AACA;AACA;AAGA;;;AAEA;AACA;AACA;AACA;AAGA;;;AAaA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAKA;AACA;AACA;AAHA;AAQA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAJA;AAQA;AACA;AAAA;AAAA;AAjDA;AAyDA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAJA;AAQA;AACA;AAAA;AAAA;AA1EA;AAkFA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAJA;AAQA;AACA;AAAA;AAAA;AApGA;AA4GA;;;;AA3OA;AA8OA;;;;;;;;;;;;;AC7QA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;;;;A","sourceRoot":""}